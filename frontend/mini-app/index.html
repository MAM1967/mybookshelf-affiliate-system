<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBookshelf - Weekly Recommendations</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .verse {
        background: #f8f9fa;
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #e9ecef;
        font-style: italic;
        color: #6c757d;
      }

      .content {
        padding: 40px;
      }

      .filters {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .filter-btn {
        background: #f8f9fa;
        border: 2px solid #dee2e6;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .filter-btn:hover,
      .filter-btn.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }

      .recommendations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 30px;
      }

      .recommendation-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        transition: transform 0.3s ease;
        border: 1px solid #f1f3f4;
      }

      .recommendation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .card-image {
        width: 100%;
        height: 200px;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 14px;
        overflow: hidden;
      }

      .card-image img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        max-width: 100%;
        max-height: 100%;
      }

      .card-content {
        padding: 20px;
      }

      .card-title {
        font-size: 1.3em;
        font-weight: 600;
        margin-bottom: 8px;
        color: #2c3e50;
      }

      .card-author {
        color: #6c757d;
        margin-bottom: 12px;
        font-size: 0.95em;
      }

      .card-price {
        font-size: 1.4em;
        font-weight: 700;
        color: #28a745;
        margin-bottom: 15px;
      }

      .card-category {
        display: inline-block;
        background: #e9ecef;
        color: #495057;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.8em;
        margin-bottom: 15px;
      }

      .affiliate-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        width: 100%;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .affiliate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }

      .loading {
        text-align: center;
        padding: 60px;
        color: #6c757d;
      }

      .error {
        text-align: center;
        padding: 40px;
        color: #dc3545;
        background: #f8d7da;
        border-radius: 8px;
        margin: 20px 0;
      }

      .footer {
        background: #2c3e50;
        color: white;
        text-align: center;
        padding: 30px;
        margin-top: 40px;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2em;
        }

        .content {
          padding: 20px;
        }

        .recommendations-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>üìö MyBookshelf</h1>
        <p>Weekly Leadership & Productivity Recommendations</p>
      </header>

      <div class="verse">
        <p>
          "Commit to the LORD whatever you do, and he will establish your
          plans." - Proverbs 16:3
        </p>
      </div>

      <div class="content">
        <div class="filters">
          <button class="filter-btn active" data-filter="all">All Items</button>
          <button class="filter-btn" data-filter="Books">Books</button>
          <button class="filter-btn" data-filter="Accessories">
            Accessories
          </button>
        </div>

        <div id="loading" class="loading">
          <p>üìñ Loading recommendations...</p>
        </div>

        <div id="error" class="error" style="display: none">
          <p>‚ùå Unable to load recommendations. Please try again later.</p>
        </div>

        <div
          id="recommendations"
          class="recommendations-grid"
          style="display: none"
        >
          <!-- Recommendations will be loaded here -->
        </div>
      </div>

      <footer class="footer">
        <p>Built with ‚ù§Ô∏è for Christian professionals seeking growth</p>
        <p>Powered by Supabase ‚Ä¢ Amazon Associates Program</p>
      </footer>
    </div>

    <script>
      // Configuration - Replace with your actual Supabase credentials
      const SUPABASE_URL = "https://ackcgrnizuhauccnbiml.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFja2Nncm5penVoYXVjY25iaW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMjc4MzEsImV4cCI6MjA2NjgwMzgzMX0.SXpIMuNBgUhcEQUHzpEB1zZAdF-UTGvmY81EFUtsAwc";

      // PERMANENT BASE64 IMAGE DATA URLS - No external dependencies!
      const PERMANENT_IMAGES = {
        9: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAEsBAMAAAB01OGNAAAAG1BMVEVKkOL///+71fTo8fvR4/eNuexgneV3q+mkx/BjUjTRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB90lEQVR4nO3Uz46aUBTH8ROLyGOQm4g8QNM1cWG3ZFra7Y0x1CVxZsQloe3oY/fwV2ymSNMmTZrvJ5nRAwd+9x5FEQAAAAAAAAAAAAAAAAAAAAAAAAAAgP+RHanGuBP7ZuatiaNrZVauPzxrsr6Yh/HwylRkO3k5gUgf4li52YnW5bW4ve48fSevhAxoPe+X/9O6z5MTmpCNeS97UzQhbrGIZXEswzZ0U+ihgwn2Xy9ZIZ68mJWOMdivL3YvYoz1tiZb6OudkLV1ZCMnvWmaWv1MIpnt7KINjSLxMt2ru0v1hCNr/Vtp+T3Vvc0yN3L0Amcsod2JeEe/mrlzuRQacpbtth5iFeIneiZqxlWFvJNZ6jfj2lbHkjdWggkhutbnZfKxHZevl54fkqQN0VWe5OFTH6LNX4ouRHd/0oCX+XJ0Wm1IvsrzPkTvdMjzrA3xMm05+K+GPLchsjATQo7VBLqQ+bFovkpae7EbNNO5htTj+tyNqw7Rz+1+SLYZhEhomy+z/r9olXUhgXyomm3VnFQh2rD5jZBduLyGGHHXpT4gTv3EP+qBsh7XU1nWIbtwJbtSj7jrb1kVMgvHx9VJb0vX9m918N3PgB0022Hb9If/F6I/vcF97mF02n8pJL7fAwAAAAAAAAAAAAAAAAAAAAAAAADAv/UDCshiTZSwMCgAAAAASUVORK5CYII=", // The Five Dysfunctions (ID 9)
        10: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAEsBAMAAAB01OGNAAAAG1BMVEVKkOL///93q+mkx/CNuey71fRgneXR4/fo8fuKQoJcAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACqUlEQVR4nO3VTVPaUBSH8QMhgSVosVs6tY7LtMq0S6pDZclUHLsEteoynUphSRUGPnbPuSEoRSIdZdN5fr6RQ+793zeiCAAAAAAAAAAAAAAAAAAAAAAAAAAAgHq7Z2qZ9sI7+8mL6kuElB8NyU7SQ7zFYaXZ0J/FEP9TJTWkUHm0/G8hmfPm+kOOguLLh7zrWqvcaWtavdEvVT9uV8WzIZzLRbX7RSTMnX5NQuKKNgpqemu39kTI9+Hhpu726OAocsVgSz7qn+vW9l1V8qFNKCjvb/fbQbF38D6UH6VSqTit9A/qw4HstrZ7T4R0RTptudax/HTFXGTXcqcnYCS5gVZurZwPg9ehZIv3y5UPfd28ziAYSjyYlBAdf77mBr8bt63Zt+t95AKy9lK8KCjHgUmIF9l+egMvSu5ZHqJN/NBtQ3wGOm4yNkg5cd9+GE9Q19E2bBaSizr2e6BDEtlKD9GetUdbkrh11W2La1l1kXZHvdeP3KE7Tm6ziguJ3PXtKiElYx3LWB82d1KYhmjYkS5k6/JiPsRVbCcKYcaavlp1Jk52U0O+zWaiK3cjwa1brgchcSVbrlyMn/rcPAgZJjW3GZlKfHZt5bRvq3lzIXHFb/X0E+ImvVLISVJz4/KbdmRc8dhrugOanwuJK/Ec/OZCx0tC3rSnNXeOswM7Slk7s7vak3XTuA+pybTi3+xos+zyk/VXiKeLfCbT0Yuunj6KG/a60NBuNsQbzkL8KKlIvf9bP7R6a1BZJUQa4/4wqVlUbtL/ZQ9IT5858nk8uj9dwaTXjCtu5k29tTeppc5m5uxy/jrYeXBxufBOUrF1DWzV1mr5x/DlBOnb/nx2Uq7SD/DzXY32Pm6uOUP/Px5+WHsGAAAAAAAAAAAAAAAAAAAAAAAAgP/DH+3gfUc83QGdAAAAAElFTkSuQmCC", // The Advantage (ID 10)
        11: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAEsBAMAAAB01OGNAAAAG1BMVEVKkOL///+kx/CNuex3q+no8fu71fRgneXR4/cvmpPyAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACY0lEQVR4nO3Uz2/aMBjH4RdICcetY0uPiG7AMZOg3ZEKQa8tPzaOSBusxzBadUe2ipQ/e7YTIEmTCGnaZfo8rUxwbH9tx0EEAAAAAAAAAAAAAAAAAAAAAAAAAAD8pfPMO07kuqmLXuKOI0eyJvsx8kJGumilhKT2TCp/6KpynHYr2j81pJnVM6nwY3ZM09QQOTbkk/3q34c8qb9d0wvfFSnajaYMfC/YjQv/fSxk1fAvVUjp7ptEtstqLC5zMmxHda28VkQennrzriz77flqNHDMfFVVKxpivzvvbTyp+u3OTDcIe87bvbuckNJall44n6H66sjyWcpzTxYmZJiyXZWavHXNLSdcifUlf7cqrv43TUs3qljI0hXrjUhfj2GqjFs95TNzWVzLqYQNgp6qJtfSLMY0VTPUXdXC9Fm4MrtRS1mJal9VH4XuYSU3kqthHotpeuLqUE/F6pClDjFV8ZCL7WZtRlcbsAuRjZsy9MG0Xq8Pg6ZqaqqIhZiqWEj/6+MqDKkdQkq/fnvZGdapCpmHK+m+XEkyxB6b7UqGiAyq2SHlWbCE/XZdSe526fbFIOTEjYZIJzvETFX1HO8CW7EQUxUN0SehEjx4dUCiIYXs/errQh0OPYblmMGiIdb+9yOyks5azswXcXY3gswsi3AE876q3+Of61iIrrKiIVZViiP1njzr19aE6J6WK/Y2e7uqYdTD1FdPdLIZSjykNNlOoiHycfpZn67+dtoNQnRPez69/Z4dsnevV2tfv6i3rxPb8Bhpf7i6zznBAAAAAAAAAAAAAAAAAAAAAAAAAAAA8H/4A2MRrFBTNecMAAAAASUVORK5CYII=", // Atomic Habits (ID 11)
        12: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAEsBAMAAAB01OGNAAAAG1BMVEUop0X///9dvXNCslyT06J4yIrk9OfJ6dCu3rmFuCizAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB/UlEQVR4nO3TS2/aQBSG4SNfYH6G1USF5TRIhSVSIbC0qqh0ybJLC4rspUVI7Z/dM4xxrFQIr6o2eh+BL8PhfJ4ZEAEAAAAAAAAAAAAAAAAAAAAAAAAAAHhv7t7cx0n3LrJ6MJ2BhyttzJVxb/m2OvnjbtAZeLrSZnBlvHdI178essrnsskLd/E9ifKfYiarZFYUYu7zvQzFzPTUhMR5YY3bBFfzvMptnOdlj5BoLi9iJUrjUh6ThZjUbBLZSSjmIJ+1gdnJ1DYh68mzoXt0V1OlQRa6JrdDtEK/JkHpLpKtSGYyET2LKWVotV8q8bwJ0eGjD9Gak9bq6LhHyPicc78up9r2Q6n9taus7XlPTKL9rD6BDwm16ZMP0Zpn9woWdY+Qj3VdyejrQzlzIT/qOnMbHlRfOiGuuQtxYWMfkviQ4HDXcyYie33Yy0xcV7XphviZLF1IMxPrQ4a213KdKzKJ2j1pQoy9hLR7cnR7stS+n15DdGV7hBjXYCujUn9m35JTGzJsQ/YyPVeHW1noykWp/GpDBhIUN0Iec/1bVKcXGVXHUqpqkZhinboG6/rQLteo3mnttM71vqhsWFSjNiQoilvL5U30fX54dwjt66BnrL+eXD6+lPjp9QjowdjbNf9HSPQ3QgAAAAAAAAAAAAAAAAAAAAAAAAAA79NveR1bxWhe2yEAAAAASUVORK5CYII=", // Leadership Journal (ID 12)
      };

      // Initialize Supabase client
      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      let allRecommendations = [];
      let currentFilter = "all";

      async function loadRecommendations() {
        const loadingEl = document.getElementById("loading");
        const errorEl = document.getElementById("error");
        const recommendationsEl = document.getElementById("recommendations");

        try {
          // Show loading state
          loadingEl.style.display = "block";
          errorEl.style.display = "none";
          recommendationsEl.style.display = "none";

          // If Supabase credentials are not configured, show mock data
          if (SUPABASE_URL === "YOUR_SUPABASE_URL") {
            console.log(
              "Using mock data - configure Supabase credentials for live data"
            );
            allRecommendations = getMockData();
          } else {
            // Fetch from Supabase
            const { data, error } = await supabase
              .from("books_accessories")
              .select("*")
              .order("timestamp", { ascending: false })
              .limit(10);

            if (error) throw error;
            allRecommendations = data || [];
          }

          // Hide loading, show content
          loadingEl.style.display = "none";
          recommendationsEl.style.display = "grid";

          // Render recommendations
          await renderRecommendations();
        } catch (error) {
          console.error("Error loading recommendations:", error);
          loadingEl.style.display = "none";
          errorEl.style.display = "block";
        }
      }

      function getMockData() {
        return [
          {
            id: 9,
            title: "The Five Dysfunctions of a Team",
            author: "Patrick Lencioni",
            price: 14.99,
            affiliate_link:
              "https://amazon.com/dp/EXAMPLE123?tag=mybookshelf-20",
            image_url:
              "https://images-na.ssl-images-amazon.com/images/I/51xJm-e3BSL.jpg",
            category: "Books",
            timestamp: new Date().toISOString(),
          },
          {
            id: 10,
            title: "The Advantage",
            author: "Patrick Lencioni",
            price: 16.99,
            affiliate_link:
              "https://amazon.com/dp/EXAMPLE124?tag=mybookshelf-20",
            image_url:
              "https://images-na.ssl-images-amazon.com/images/I/51abc-def.jpg",
            category: "Books",
            timestamp: new Date().toISOString(),
          },
          {
            id: 11,
            title: "Atomic Habits",
            author: "James Clear",
            price: 13.99,
            affiliate_link:
              "https://amazon.com/dp/EXAMPLE125?tag=mybookshelf-20",
            image_url:
              "https://images-na.ssl-images-amazon.com/images/I/atomic-habits.jpg",
            category: "Books",
            timestamp: new Date().toISOString(),
          },
          {
            id: 12,
            title: "Leadership Journal - Daily Planner",
            author: "Business Essentials",
            price: 24.99,
            affiliate_link:
              "https://amazon.com/dp/EXAMPLE456?tag=mybookshelf-20",
            image_url:
              "https://images-na.ssl-images-amazon.com/images/I/journal.jpg",
            category: "Accessories",
            timestamp: new Date().toISOString(),
          },
        ];
      }

      function renderRecommendations() {
        const container = document.getElementById("recommendations");
        const filteredItems =
          currentFilter === "all"
            ? allRecommendations
            : allRecommendations.filter(
                (item) => item.category === currentFilter
              );

        container.innerHTML = filteredItems
          .map((item) => {
            const imageUrl = getImageUrl(
              item.image_url,
              item.title,
              item.category,
              item.id
            );

            return `
              <div class="recommendation-card">
                <div class="card-image">
                                  <img src="${imageUrl}" alt="${item.title}" 
                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIj4KICAgIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjNkM3NTdEIi8+CiAgICA8dGV4dCB4PSIxMDAiIHk9IjE1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCI+Qm9vazwvdGV4dD4KICA8L3N2Zz4='; this.onerror=null;">
                </div>
                <div class="card-content">
                  <div class="card-category">${item.category}</div>
                  <h3 class="card-title">${item.title}</h3>
                  <p class="card-author">by ${item.author}</p>
                  <div class="card-price">$${parseFloat(item.price).toFixed(
                    2
                  )}</div>
                  <a href="${
                    item.affiliate_link
                  }" target="_blank" class="affiliate-btn">
                    üõí View on Amazon
                  </a>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function getImageUrl(originalUrl, title, category, itemId) {
        // Use permanent base64 images - 100% reliable, no external dependencies
        if (PERMANENT_IMAGES[itemId]) {
          return PERMANENT_IMAGES[itemId];
        }

        // Fallback to CSS-generated image (pure CSS, no external calls)
        const bgColor = category === "Books" ? "#4A90E2" : "#28A745";
        return `data:image/svg+xml;base64,${btoa(`
          <svg xmlns="http://www.w3.org/2000/svg" width="200" height="300">
            <rect width="200" height="300" fill="${bgColor}"/>
            <text x="100" y="150" text-anchor="middle" fill="white" font-family="Arial" font-size="14">
              ${title.substring(0, 15)}
            </text>
          </svg>
        `)}`;
      }

      function setupFilters() {
        const filterBtns = document.querySelectorAll(".filter-btn");

        filterBtns.forEach((btn) => {
          btn.addEventListener("click", async () => {
            // Update active state
            filterBtns.forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");

            // Update filter and re-render
            currentFilter = btn.dataset.filter;
            await renderRecommendations();
          });
        });
      }

      // Initialize app
      document.addEventListener("DOMContentLoaded", async () => {
        setupFilters();
        await loadRecommendations();
      });
    </script>
  </body>
</html>
